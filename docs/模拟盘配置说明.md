# 模拟盘配置说明

## 📝 总结

我已经为你的交易系统添加了完整的模拟盘支持。现在你可以：

1. ✅ **提示词文件化**：所有AI策略提示词都在 `prompts/` 目录中
2. ✅ **热更新**：修改提示词文件后自动生效，无需重启
3. ✅ **模拟盘支持**：可以在实盘和模拟盘之间自由切换

## 🎯 使用模拟盘的步骤

### 步骤1：获取模拟盘API密钥

1. 登录 [OKX官网](https://www.okx.com)
2. 进入**模拟盘交易**页面
3. 创建**模拟盘API密钥**（与实盘API密钥是分开的）
4. 记录下：
   - API Key
   - Secret Key  
   - Passphrase

### 步骤2：配置模拟盘密钥

在 `.env` 文件中添加模拟盘密钥：

```bash
# 实盘API密钥（保留原有的）
OKX_API_KEY=your_real_api_key
OKX_SECRET=your_real_secret
OKX_PASSWORD=your_real_password

# 模拟盘API密钥（新增）
OKX_TESTNET_API_KEY=your_testnet_api_key
OKX_TESTNET_SECRET=your_testnet_secret
OKX_TESTNET_PASSWORD=your_testnet_password

# DeepSeek API（保留原有的）
DEEPSEEK_API_KEY=your_deepseek_key
```

### 步骤3：启用模拟盘

在 `config.py` 中设置：

```python
TRADING_CONFIG = {
    # ... 其他配置 ...
    'use_testnet': True,  # True=模拟盘，False=实盘
    # ... 其他配置 ...
}
```

### 步骤4：运行程序

```bash
python3.11 main.py
```

你会看到：
```
🧪 使用模拟盘连接OKX...
ℹ️  模拟盘 - 将使用逐仓模式（isolated）
```

## 🔄 切换实盘/模拟盘

### 切换到模拟盘
```python
# config.py
'use_testnet': True
```

### 切换到实盘
```python
# config.py
'use_testnet': False
```

## ⚠️ 重要提示

1. **API密钥分离**：实盘和模拟盘使用**完全不同**的API密钥
2. **资金安全**：模拟盘使用虚拟资金，不会影响真实资金
3. **测试建议**：
   - 新策略先在模拟盘测试
   - 确认稳定盈利后再切换实盘
   - 定期检查模拟盘和实盘的表现差异

## 📊 AI提示词管理

### 可用策略

所有策略文件在 `prompts/` 目录：

- `default.txt` - 默认策略（5-10%止盈，2-3%止损）
- `stable_profit.txt` - 稳定盈利（3%止盈，1.5%止损）
- `aggressive.txt` - 激进策略（7%止盈，2.5%止损）
- `balanced.txt` - 平衡策略（5%止盈，2%止损）

### 使用方法

**方法1：在main.py中指定**
```python
trader = PureAITrader(ai_client, strategy='stable_profit')
```

**方法2：查看所有策略**
```python
trader.list_available_strategies()
```

**方法3：运行时切换**
```python
trader.switch_strategy('aggressive')
```

### 热更新

直接编辑 `prompts/` 目录中的txt文件，下次AI调用时自动生效，无需重启程序！

## 🧪 测试流程建议

1. **模拟盘测试**（1-2周）
   ```python
   'use_testnet': True
   ```
   - 使用 `stable_profit.txt` 策略
   - 观察胜率和盈亏
   - 调整参数

2. **小资金实盘**（1-2周）
   ```python
   'use_testnet': False
   'initial_balance': 200.0  # 小资金
   ```
   - 继续使用稳定策略
   - 验证实盘表现

3. **正常资金实盘**
   ```python
   'use_testnet': False
   'initial_balance': 1000.0  # 正常资金
   ```
   - 根据表现选择策略
   - 可以尝试 `balanced` 或 `aggressive`

## 🔍 故障排查

### 问题1：APIKey does not match current environment

**原因**：使用了错误的API密钥
- 模拟盘需要模拟盘密钥
- 实盘需要实盘密钥

**解决**：
1. 检查 `.env` 文件中的密钥配置
2. 确认 `config.py` 中的 `use_testnet` 设置
3. 重新获取对应环境的API密钥

### 问题2：提示词没有更新

**原因**：可能是文件编码问题

**解决**：
1. 确保txt文件使用UTF-8编码
2. 检查文件名是否正确（如 `stable_profit.txt`）
3. 查看控制台是否有 "🔄 提示词已更新" 消息

### 问题3：网络连接失败

**原因**：无法访问OKX服务器

**解决**：
1. 检查网络连接
2. 如需代理，设置环境变量：
   ```bash
   export HTTP_PROXY=http://127.0.0.1:7890
   export HTTPS_PROXY=http://127.0.0.1:7890
   ```

## 📚 相关文档

- `prompts/README.md` - 提示词目录说明
- `HOW_TO_USE_PROMPTS.md` - 提示词使用指南
- `config.py` - 配置文件

## 💡 最佳实践

1. **先模拟后实盘**：所有新策略都先在模拟盘测试
2. **小额开始**：实盘从小资金开始，逐步增加
3. **记录日志**：保存每次测试的结果和参数
4. **定期评估**：每周评估策略表现，及时调整
5. **风险控制**：严格执行止损，不要侥幸心理
