# é¡¹ç›®ç»“æ„è¯´æ˜

## ğŸ“ ç›®å½•ç»“æ„

```
multi_agent_trading/
â”œâ”€â”€ config/                     # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ settings.py            # ä¸»é…ç½® (åŸconfig.py)
â”‚   â””â”€â”€ mcp_config.json        # MCPé…ç½®
â”‚
â”œâ”€â”€ core/                       # æ ¸å¿ƒäº¤æ˜“é€»è¾‘
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ trading_executor.py    # äº¤æ˜“æ‰§è¡Œå™¨ (300è¡Œ)
â”‚   â”œâ”€â”€ position_manager.py    # æŒä»“ç®¡ç†å™¨ (200è¡Œ)
â”‚   â””â”€â”€ order_sync.py          # è®¢å•åŒæ­¥å™¨ (180è¡Œ)
â”‚
â”œâ”€â”€ data/                       # æ•°æ®å±‚
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ database.py            # äº¤æ˜“æ•°æ®åº“ (åŸtrade_database.py)
â”‚   â”œâ”€â”€ fetcher.py             # æ•°æ®è·å–å™¨ (åŸutils/data_fetcher.py)
â”‚   â””â”€â”€ indicators.py          # æŠ€æœ¯æŒ‡æ ‡ (åŸutils/indicators.py)
â”‚
â”œâ”€â”€ ai/                         # AIå±‚
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ trader.py              # AIäº¤æ˜“å‘˜ (åŸpure_ai_trader.py, 1552è¡Œ)
â”‚   â””â”€â”€ conversation.py        # å¯¹è¯ç›‘æ§ (åŸconversation_monitor.py)
â”‚
â”œâ”€â”€ mcp/                        # MCPè®°å¿†ç³»ç»Ÿ
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ integration.py         # MCPé›†æˆ (åŸmcp_integration.py, 1309è¡Œ)
â”‚   â””â”€â”€ sync.py                # MCPæ•°æ®åº“åŒæ­¥ (åŸmcp_sync.py)
â”‚
â”œâ”€â”€ utils/                      # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ data_formatter.py
â”‚   â””â”€â”€ kline_visualizer.py
â”‚
â”œâ”€â”€ prompts/                    # AIæç¤ºè¯
â”‚   â”œâ”€â”€ default.txt
â”‚   â”œâ”€â”€ aggressive.txt
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ main.py                     # ä¸»å…¥å£ (377è¡Œï¼ŒåŸ1563è¡Œ)
â”œâ”€â”€ requirements.txt
â””â”€â”€ docs/                       # æ–‡æ¡£
    â”œâ”€â”€ ä»£ç é‡æ„è®¡åˆ’.md
    â””â”€â”€ é¡¹ç›®ç»“æ„è¯´æ˜.md
```

## ğŸ¯ æ¨¡å—èŒè´£

### config/ - é…ç½®ç®¡ç†
ç»Ÿä¸€ç®¡ç†æ‰€æœ‰é…ç½®æ–‡ä»¶

- **settings.py**: ä¸»é…ç½®æ–‡ä»¶
  - APIå¯†é’¥é…ç½®ï¼ˆDeepSeekã€OKXï¼‰
  - äº¤æ˜“é…ç½®ï¼ˆäº¤æ˜“å¯¹ã€æ•°é‡ã€æ æ†ç­‰ï¼‰
  - æ—¶é—´æ¡†æ¶é…ç½®
  - æ•°æ®ç‚¹é…ç½®

- **mcp_config.json**: MCPè®°å¿†ç³»ç»Ÿé…ç½®
  - MCPæœåŠ¡å™¨é…ç½®
  - è®°å¿†å­˜å‚¨è·¯å¾„

### core/ - æ ¸å¿ƒäº¤æ˜“é€»è¾‘
è´Ÿè´£æ‰€æœ‰äº¤æ˜“ç›¸å…³çš„æ‰§è¡Œæ“ä½œ

- **trading_executor.py**: äº¤æ˜“æ‰§è¡Œ
  - `execute_trade()` - æ‰§è¡Œå¼€ä»“/å¹³ä»“
  - `execute_close_all()` - æ¸…ä»“æ‰€æœ‰æŒä»“
  - `execute_position_reviews()` - æ‰§è¡ŒæŒä»“ç®¡ç†å»ºè®®

- **position_manager.py**: æŒä»“ç®¡ç†
  - `sync_database_with_positions()` - åŒæ­¥æ•°æ®åº“ä¸å®é™…æŒä»“
  - `get_position_trade_mode()` - è·å–æŒä»“äº¤æ˜“æ¨¡å¼
  - `validate_position_consistency()` - éªŒè¯æŒä»“ä¸€è‡´æ€§

- **order_sync.py**: è®¢å•åŒæ­¥
  - `sync_filled_orders_from_api()` - ä»APIåŒæ­¥å†å²æˆäº¤

### data/ - æ•°æ®å±‚
è´Ÿè´£æ‰€æœ‰æ•°æ®è·å–ã€å­˜å‚¨å’Œå¤„ç†

- **database.py**: äº¤æ˜“æ•°æ®åº“
  - è®°å½•äº¤æ˜“å†å²
  - æŸ¥è¯¢äº¤æ˜“ç»Ÿè®¡
  - ç®¡ç†äº¤æ˜“çŠ¶æ€

- **fetcher.py**: æ•°æ®è·å–å™¨
  - è·å–å¸‚åœºæ•°æ®
  - è·å–è´¦æˆ·ä¿¡æ¯
  - è·å–æŒä»“ä¿¡æ¯

- **indicators.py**: æŠ€æœ¯æŒ‡æ ‡
  - è®¡ç®—æŠ€æœ¯æŒ‡æ ‡ï¼ˆMAã€RSIã€MACDç­‰ï¼‰
  - æ ¼å¼åŒ–å¸‚åœºæ•°æ®

### ai/ - AIå±‚
è´Ÿè´£AIå†³ç­–å’Œå¯¹è¯ç®¡ç†

- **trader.py**: AIäº¤æ˜“å‘˜
  - AIå†³ç­–æ ¸å¿ƒé€»è¾‘
  - æç¤ºè¯ç®¡ç†
  - å¯¹è¯å†å²ç®¡ç†
  - MCPè®°å¿†é›†æˆ

- **conversation.py**: å¯¹è¯ç›‘æ§
  - ç›‘æ§AIå¯¹è¯
  - è®°å½•å†³ç­–è¿‡ç¨‹

### mcp/ - MCPè®°å¿†ç³»ç»Ÿ
è´Ÿè´£AIçš„è®°å¿†å’Œå­¦ä¹ èƒ½åŠ›

- **integration.py**: MCPé›†æˆæ ¸å¿ƒ (1309è¡Œ)
  - `MCPTradingMemory` - äº¤æ˜“è®°å¿†ç®¡ç†
  - `MCPFileSystem` - æ–‡ä»¶ç³»ç»Ÿç®¡ç†
  - `MCPIntelligence` - æ™ºèƒ½åˆ†æ
  - `MarketStateAnalyzer` - å¸‚åœºçŠ¶æ€åˆ†æ

- **sync.py**: MCPæ•°æ®åº“åŒæ­¥
  - åŒæ­¥äº¤æ˜“è®°å½•åˆ°MCP
  - æ›´æ–°AIè®°å¿†

**[åç»­å¯æ‹†åˆ†]**: integration.pyå¯ä»¥è¿›ä¸€æ­¥æ‹†åˆ†ä¸ºï¼š
  - memory.py - MCPTradingMemory
  - filesystem.py - MCPFileSystem
  - intelligence.py - MCPIntelligence
  - market_analyzer.py - MarketStateAnalyzer

## ğŸ“Š é‡æ„æˆæœ

### ä»£ç è¡Œæ•°å¯¹æ¯”

| æ–‡ä»¶ | é‡æ„å‰ | é‡æ„å | å‡å°‘ |
|------|--------|--------|------|
| main.py | 1563è¡Œ | 377è¡Œ | -76% |
| æ€»è®¡ï¼ˆæ ¸å¿ƒæ¨¡å—ï¼‰ | 1563è¡Œ | ~1057è¡Œ | -32% |

**æ³¨**: è™½ç„¶æ€»è¡Œæ•°çœ‹èµ·æ¥å‡å°‘ä¸å¤šï¼Œä½†ä»£ç è¢«åˆç†æ‹†åˆ†åˆ°äº†å¤šä¸ªæ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—èŒè´£å•ä¸€ï¼Œå¯ç»´æŠ¤æ€§å¤§å¹…æå‡ã€‚

### æ¨¡å—åŒ–æ”¶ç›Š

1. **èŒè´£æ¸…æ™°**: æ¯ä¸ªæ¨¡å—åªè´Ÿè´£ä¸€ä»¶äº‹
2. **æ˜“äºæµ‹è¯•**: å¯ä»¥å•ç‹¬æµ‹è¯•æ¯ä¸ªæ¨¡å—
3. **æ˜“äºç»´æŠ¤**: ä¿®æ”¹æŸä¸ªåŠŸèƒ½åªéœ€è¦æ”¹å¯¹åº”æ¨¡å—
4. **æ˜“äºæ‰©å±•**: æ–°åŠŸèƒ½å¯ä»¥ç‹¬ç«‹æ·»åŠ æ–°æ¨¡å—
5. **ä»£ç å¤ç”¨**: æ¨¡å—å¯ä»¥åœ¨ä¸åŒåœ°æ–¹å¤ç”¨

## ğŸ”„ å¯¼å…¥å…³ç³»

```
main.py
â”œâ”€â”€ config
â”œâ”€â”€ ai.PureAITrader
â”œâ”€â”€ data.DataFetcher
â”œâ”€â”€ data.TradeDatabase
â”œâ”€â”€ mcp.MCPDatabaseSync
â””â”€â”€ core
    â”œâ”€â”€ TradingExecutor
    â”œâ”€â”€ PositionManager
    â””â”€â”€ OrderSync

coreæ¨¡å—
â”œâ”€â”€ config
â””â”€â”€ ä¾èµ–dataå±‚çš„å®ä¾‹

dataæ¨¡å—
â””â”€â”€ config

aiæ¨¡å—
â”œâ”€â”€ config
â”œâ”€â”€ dataå±‚
â””â”€â”€ mcpå±‚

mcpæ¨¡å—
â”œâ”€â”€ dataå±‚
â””â”€â”€ ç‹¬ç«‹çš„è®°å¿†ç³»ç»Ÿ
```

## ğŸš€ ä½¿ç”¨æ–¹å¼

### å¯åŠ¨äº¤æ˜“ç³»ç»Ÿ

```python
from main import SimpleAITradingBot

bot = SimpleAITradingBot()
bot.run(interval=900)  # 15åˆ†é’Ÿå‘¨æœŸ
```

### ä½¿ç”¨ç‹¬ç«‹æ¨¡å—

```python
# ä½¿ç”¨äº¤æ˜“æ‰§è¡Œå™¨
from core import TradingExecutor
from data import DataFetcher, TradeDatabase

data_fetcher = DataFetcher()
trade_db = TradeDatabase()
executor = TradingExecutor(data_fetcher, trade_db)

# æ‰§è¡Œäº¤æ˜“
executor.execute_trade(decision, price, market_data)
```

```python
# ä½¿ç”¨æŒä»“ç®¡ç†å™¨
from core import PositionManager

manager = PositionManager(data_fetcher, trade_db)
manager.sync_database_with_positions(current_position)
```

## ğŸ“ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°åŠŸèƒ½

1. **ç¡®å®šåŠŸèƒ½å±äºå“ªä¸ªå±‚**
   - äº¤æ˜“æ‰§è¡Œ â†’ core/
   - æ•°æ®å¤„ç† â†’ data/
   - AIå†³ç­– â†’ ai/
   - è®°å¿†å­¦ä¹  â†’ mcp/

2. **åœ¨å¯¹åº”æ¨¡å—æ·»åŠ æ–¹æ³•æˆ–åˆ›å»ºæ–°æ–‡ä»¶**

3. **æ›´æ–° `__init__.py` å¯¼å‡º**

4. **åœ¨main.pyä¸­é›†æˆ**

### ä¿®æ”¹ç°æœ‰åŠŸèƒ½

1. **æ‰¾åˆ°å¯¹åº”çš„æ¨¡å—æ–‡ä»¶**
2. **ä¿®æ”¹å…·ä½“æ–¹æ³•**
3. **ç¡®ä¿ä¸ç ´åæ¥å£**
4. **æµ‹è¯•åŠŸèƒ½**

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **è·¯å¾„é—®é¢˜**: ç”±äºç›®å½•é‡ç»„ï¼ŒæŸäº›æ¨¡å—éœ€è¦æ·»åŠ  `sys.path` é…ç½®
2. **å‘åå…¼å®¹**: ä¿æŒAPIæ¥å£ä¸å˜ï¼Œé¿å…ç ´åç°æœ‰åŠŸèƒ½
3. **æµ‹è¯•**: æ¯æ¬¡ä¿®æ”¹åéƒ½è¦æµ‹è¯•ä¸»æµç¨‹
4. **æ–‡æ¡£**: åŠæ—¶æ›´æ–°æ–‡æ¡£

## ğŸ”œ ä¸‹ä¸€æ­¥è®¡åˆ’

1. **æ‹†åˆ† ai/trader.py** (1552è¡Œ â†’ <800è¡Œ)
   - æå–æç¤ºè¯ç®¡ç† â†’ ai/prompt_manager.py
   - æå–å¯¹è¯ç®¡ç† â†’ ai/conversation_manager.py
   - æå–æ•°æ®æ ¼å¼åŒ– â†’ data/formatter.py

2. **æ‹†åˆ† mcp_integration.py** (1308è¡Œ â†’ å¤šä¸ªæ–‡ä»¶)
   - MCPTradingMemory â†’ mcp/memory.py
   - MCPFileSystem â†’ mcp/filesystem.py
   - MCPIntelligence â†’ mcp/intelligence.py
   - MarketStateAnalyzer â†’ mcp/market_analyzer.py

3. **æå–å…¬å…±å·¥å…·**
   - æ ¼å¼åŒ–å·¥å…· â†’ utils/formatters.py
   - éªŒè¯å·¥å…· â†’ utils/validators.py

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ä»£ç é‡æ„è®¡åˆ’](./ä»£ç é‡æ„è®¡åˆ’.md) - è¯¦ç»†çš„é‡æ„æ­¥éª¤å’Œæ—¶é—´è¡¨
- [README.md](../README.md) - é¡¹ç›®è¯´æ˜
- [requirements.txt](../requirements.txt) - ä¾èµ–åˆ—è¡¨
